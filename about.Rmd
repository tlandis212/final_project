---
title: "About"
author: "Teddy Landis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(gt)
library(lubridate)
```

For my project, I am looking at the effect first-time voting type has on future voting behaviors. If someone's first possible vote (i.e. the first possible election they can vote in after they turn 18), is cast through an absentee ballot, does that affect their likelihood of voting in future elections?

My data comes from two datasets provided by the [North Carolina Secretary of State](https://www.ncsbe.gov/Public-Records-Data-Info/Election-Results-Data) . I am using data from North Carolina because they provide both voter registration records and voter history for free on their website. I will design my project using the datasets for Alamance county, but once my project is built I will use the Statewide datasets. The statewide dataset is very large and slows my computer - I would rather wait until the end of my project to use it. Instructions on how to access this data are available in README.

Dataset 1 is alamance_hist (ncvhis1.txt). It is a .txt file that I downloaded from the North Carolina Secretary of State. It contains records for each vote cast. Dataset 2 is almanace_reg (ncvoter1.txt) and it contains each voter's voter registration record. Both contain a "voter registration number" which I can use to merge the datasets. The statewide datasets are identical but include more observations.

My repository can be found [here](https://github.com/tlandis212/final_project).

*Milestone 4 Update*: I further cleaned up my datafile. It is now smaller and only includes essential variables.

My plan is to create topline descriptions of how many people voted in each election after the previous one.


```{r merge, echo = FALSE}
# I didn't include the dataset in my repository because the file are too large.
# Information on how to download my datasets can be found in my README.md. In a
# Piazza post, it was suggested this was a viable alternative to using GitHub
# LFS.

# Load in both datasets

alamance_hist <- read.delim("raw-data/ncvhis1.txt")
alamance_reg <- read.delim("raw-data/ncvoter1.txt")

# Use full join to merge both datasets

alamance_full_voter <- full_join(alamance_hist, alamance_reg, by=c("voter_reg_num"))

# Find a list of all elections and their turnout. Due to the high number of
# extremely low turn out local elections, I am limiting this to the top 15. I
# filtered out missing values for election_desc as this filters out voters who
# have never cast a ballot.

turnout <- alamance_full_voter %>% 
  mutate(election_lbl = mdy(election_lbl)) %>% 
  filter(!is.na(election_desc)) %>% 
  count(election_lbl, election_desc) %>% 
  arrange(desc(n)) %>% 
  slice(1:15)

# I plotted turnout for each election, sorted in descending order of turnout. I
# used coord_flip() so the full election names can be shown. Because I'm using
# the count variable from my tibble (rather than doing it through geom_bar()), I
# needed to set stat = "identity".

ggplot(turnout, aes(reorder(election_desc, -n), n)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  theme_classic() +
  labs(title = "Turnout in Alamance, NC by Election", subtitle = "Number of Raw Votes Cast", caption = "Data Source: NC Secretary of State", x = "Election", y = "Votes Cast")
  

# Reduce the number of variables by eliminating unwanted variables and filter to
# only include voters who would be voting for the first time in 2008 or
# post-2008 elections

alamance_full_voter_reduced <- alamance_full_voter %>% 
  select(county_id.x:election_lbl, voting_method:voted_party_cd, status_cd:absent_ind, birth_year, birth_state) %>% 
  filter(birth_year >= 1990) %>% 
 mutate(election_lbl = mdy(election_lbl)) %>% 
  arrange(election_lbl) %>% 
  
  # Create a dummy variable that says if a person voted in an election
  
  pivot_wider(names_from = election_lbl, values_from = voting_method, values_fill = list(voted_method = "No Vote")) %>% 
  arrange(voter_reg_num)

# I want to see what percentage of people who voted in the 2012 general election
# also voted in the 2014 general election

alamance_full_voter_reduced %>% 
  filter()
  
          





```